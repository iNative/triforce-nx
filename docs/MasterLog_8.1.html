<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NgNest - Master Log</title>
    <style>
        :root {
            /* Palette unificata con Index.html (Smart Casual / Slate Theme) */
            --bg-primary: #0f172a;    /* Slate 900 */
            --bg-sidebar: #1e293b;    /* Slate 800 */
            --bg-card: #1e293b;
            --text-primary: #f8fafc;  /* Slate 50 */
            --text-secondary: #94a3b8; /* Slate 400 */
            --accent: #38bdf8;        /* Sky 400 */
            --accent-hover: #0ea5e9;
            --accent-glow: rgba(56, 189, 248, 0.10);
            --border: #334155;        /* Slate 700 */
            --code-bg: #020617;       /* Slate 950 */
            
            /* Syntax Highlighting */
            --kwd: #569cd6; --str: #ce9178; --ctl: #c586c0; --cls: #4ec9b0; --mtd: #dcdcaa; --var: #9cdcfe; --cmt: #6a9955; 
        }
        
        body { 
            background-color: var(--bg-primary); 
            color: var(--text-primary); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            line-height: 1.6;
        }
        
        /* --- SIDEBAR & NAV --- */
        .sidebar { 
            background-color: var(--bg-sidebar); 
            border-color: var(--border); 
            z-index: 100; 
            transition: all 0.3s ease; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
        }
        
        .sidebar ul { list-style: none; padding: 15px 10px; margin: 0; }
        
        /* Etichette Menu */
        .sidebar li a { 
            display: block; padding: 10px 15px; 
            color: var(--text-secondary); 
            text-decoration: none; 
            font-size: 0.9rem; 
            border-radius: 6px;
            transition: all 0.2s ease; 
            white-space: nowrap; 
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .sidebar li a:hover { 
            background-color: rgba(255,255,255,0.05); 
            color: var(--text-primary); 
        }
        
        .sidebar li a.active { 
            background-color: var(--accent-glow); 
            color: var(--accent); 
            font-weight: 600;
        }

        /* Config Box Interattivo (Ora in alto) */
        .config-box { 
            padding: 20px; 
            background: rgba(0,0,0,0.2); 
            border-bottom: 1px solid var(--border); /* Separatore sotto */
        }
        
        .config-box label { 
            display: block; font-size: 0.75rem; color: var(--text-secondary); 
            margin-bottom: 8px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;
        }
        
        .config-box input { 
            width: 100%; box-sizing: border-box; 
            background: var(--bg-primary); 
            border: 1px solid var(--border); 
            color: var(--accent); 
            padding: 10px; 
            border-radius: 6px; 
            font-family: 'Consolas', monospace; 
            font-size: 0.9rem; font-weight: bold; 
            transition: border-color 0.2s;
        }
        
        .config-box input:focus { 
            border-color: var(--accent); outline: none; 
            box-shadow: 0 0 0 2px var(--accent-glow);
        }
        
        .dynamic-scope { 
            color: #fbbf24; 
            font-weight: bold; 
            background: rgba(251, 191, 36, 0.1);
            padding: 0 4px; border-radius: 4px;
            cursor: help; 
        }

        /* --- LAYOUT RESPONSIVE --- */
        /* Desktop */
        @media(min-width: 1024px) {
            body { flex-direction: row; }
            .sidebar { 
                width: 280px; height: 100vh; position: fixed; top: 0; left: 0; 
                border-right: 1px solid var(--border); display: flex; flex-direction: column; 
            }
            .sidebar ul { flex-grow: 1; overflow-y: auto; }
            .main-content { 
                padding: 60px; width: 100%; max-width: 900px; 
                margin: 0 auto; margin-left: 280px; 
            }
        }
        
        /* Mobile/Tablet (<1024px) */
        @media(max-width: 1023px) {
            .sidebar { 
                width: 100%; height: auto; position: fixed; bottom: 0; left: 0; 
                border-top: 1px solid var(--border); display: flex; flex-direction: row; 
                align-items: center; overflow-x: auto; box-shadow: 0 -4px 20px rgba(0,0,0,0.3); 
                justify-content: flex-start; /* Allinea a sinistra */
            }
            
            .sidebar ul { display: flex; flex-direction: row; flex-grow: 1; }
            
            .sidebar li a { 
                border-radius: 0; padding: 15px 20px; font-size: 0.85rem; 
                border-top: 3px solid transparent; margin-bottom: 0;
            }
            .sidebar li a.active { background: transparent; border-top-color: var(--accent); }
            
            /* Su mobile, box a sinistra fisso, menu scorrevole a destra */
            .config-box { 
                border-bottom: none; 
                border-right: 1px solid var(--border); 
                padding: 10px; min-width: 160px; 
                background: transparent; 
                position: sticky; left: 0; /* Opzionale: tienilo fisso se lo scroll √® lungo */
                background-color: var(--bg-sidebar); z-index: 10;
            }
            
            .main-content { padding: 30px 20px 120px 20px; width: 100%; box-sizing: border-box; }
        }
        
        /* Typography & Components */
        h1 { 
            border-bottom: 1px solid var(--border); padding-bottom: 20px; 
            color: var(--text-primary); font-size: 2.2rem; margin-top: 0; 
            display: flex; align-items: center; gap: 15px;
        }
        
        h3 { 
            color: var(--accent); margin-top: 60px; font-size: 1.5rem;
            display: flex; align-items: center; gap: 10px;
            scroll-margin-top: 20px; 
        }
        
        h4 { color: var(--text-primary); margin-top: 35px; margin-bottom: 15px; font-size: 1.2rem; }
        
        p { color: var(--text-secondary); font-size: 1rem; }
        
        /* Inline Code */
        code.inline { 
            background-color: rgba(255,255,255,0.07); padding: 2px 6px; 
            border-radius: 4px; font-family: 'Consolas', monospace; 
            color: #e2e8f0; font-size: 0.9em; border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Code Blocks - Style Smart Casual */
        .code-container { 
            background-color: var(--bg-sidebar); 
            border: 1px solid var(--border); 
            border-radius: 8px; 
            margin: 20px 0; 
            position: relative; 
            overflow: hidden; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .code-header { 
            background-color: rgba(0,0,0,0.3); 
            padding: 10px 20px; 
            border-bottom: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; 
            color: var(--text-secondary); font-size: 0.8rem; font-family: sans-serif; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        .copy-btn { 
            background: transparent; border: 1px solid var(--border); color: var(--text-secondary); 
            border-radius: 4px; padding: 4px 12px; cursor: pointer; transition: all 0.2s; font-size: 0.75rem; 
        }
        .copy-btn:hover { background-color: var(--border); color: #fff; }
        
        pre { 
            margin: 0; padding: 25px; overflow-x: auto; 
            font-family: 'Consolas', 'Monaco', monospace; 
            color: #e2e8f0; font-size: 14px; line-height: 1.6; 
            background: var(--code-bg);
        }
        
        /* Syntax Highlighting */
        .kwd { color: var(--kwd); } .str { color: var(--str); } .ctl { color: var(--ctl); } .cls { color: var(--cls); } .mtd { color: var(--mtd); } .var { color: var(--var); } .cmt { color: var(--cmt); font-style: italic; }
        
        .cmd-label { color: var(--cls); font-weight: bold; margin-bottom: 8px; display: inline-block; font-size: 0.9rem; letter-spacing: 0.5px; border-bottom: 2px solid var(--cls); padding-bottom: 2px; }
        
        /* Alert Note */
        .note { 
            background: rgba(251, 191, 36, 0.1); 
            border-left: 4px solid #fbbf24; 
            padding: 20px; 
            font-size: 0.95rem; 
            margin: 25px 0; 
            color: #fcd34d; 
            border-radius: 0 8px 8px 0; 
        }
        .note b { color: #fbbf24; }

        /* Badge Home */
        .home-link {
            text-decoration: none; font-size: 0.8rem; color: var(--accent);
            border: 1px solid var(--border); padding: 5px 10px; border-radius: 20px;
            margin-bottom: 20px; display: inline-block; transition: all 0.2s;
        }
        .home-link:hover { background: var(--border); }

    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="config-box">
            <label for="ws-name">Workspace Name</label>
            <input type="text" id="ws-name" value="olon-platform" placeholder="es. monoRepo" oninput="updateScope()">
        </div>
        
        <ul>
            <li><a href="#section1" class="nav-link">‚úîÔ∏è Setup</a></li>
            <li><a href="#section2" class="nav-link">üì¶ Shared Types</a></li>
            <li><a href="#section3" class="nav-link">üõ†Ô∏è Backend (Nest)</a></li>
            <li><a href="#section4" class="nav-link">üíª Frontend (Ng)</a></li>
            <li><a href="#section5" class="nav-link">üöÄ Esecuzione</a></li>
        </ul>
    </nav>

    <div class="main-content">
        <a href="index.html" class="home-link">‚Üê Torna alla Documentazione</a>
        <h1>Master Log <span style="font-size: 1rem; opacity: 0.6; font-weight: normal; margin-left: auto;">v8.1</span></h1>
        <p>Manuale operativo interattivo. Usa la sidebar per aggiornare il nome del progetto in tutti i codici sottostanti.</p>

        <div id="section1">
            <h3>1. Setup Check</h3>
            <p>
                Si assume che il workspace sia stato inizializzato con lo script <code class="inline">ngnest-init.sh</code>.
            </p>
            <div class="note">‚ö†Ô∏è <b>Action Required:</b> Se non hai ancora il progetto, scarica lo script dal README ed eseguilo.</div>

            <p>Verifica ambiente e lancio setup:</p>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="cmt"># 1. Verifica Node.js (Richiesto v18+)</span>
node -v

<span class="cmt"># 2. Lancia lo script di init se sei nella cartella vuota</span>
bash ngnest-init.sh</code></pre>
            </div>
        </div>

        <div id="section2">
            <h3>2. Shared Types</h3>
            <p>Definizione contratti dati. Il path di importazione si aggiorna automaticamente in base al tuo workspace.</p>
            
            <p>File: <code class="inline">libs/shared-data/src/lib/product.interface.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>product.interface.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="cmt">// Contratto dati condiviso (Single Source of Truth)</span>
<span class="ctl">export</span> <span class="kwd">interface</span> <span class="cls">Product</span> {
  id: <span class="kwd">string</span>;
  name: <span class="kwd">string</span>;
  price: <span class="kwd">number</span>;
  description: <span class="kwd">string</span>;
}</code></pre>
            </div>
            <p>File: <code class="inline">libs/shared-data/src/index.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>index.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">export</span> * <span class="ctl">from</span> <span class="str">'./lib/shared-data'</span>;
<span class="ctl">export</span> * <span class="ctl">from</span> <span class="str">'./lib/product.interface'</span>;</code></pre>
            </div>
        </div>

        <div id="section3">
            <h3>3. Backend (NestJS)</h3>
            <div class="note">‚ö†Ô∏è <b>Nx v20 Safe:</b> Usiamo il metodo "Path-as-Name" (percorso esplicito) per evitare errori di schema.</div>

            <span class="cmd-label">üëâ Genera Risorsa 'Products' (CRUD)</span>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx g @nx/nest:resource apps/backend/src/app/products --type=rest --crud=<span class="kwd">false</span></code></pre>
            </div>
            
            <p>File: <code class="inline">apps/backend/src/app/products/products.service.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>products.service.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { Injectable } <span class="ctl">from</span> <span class="str">'@nestjs/common'</span>;
<span class="cmt">// Import DINAMICO (si aggiorna con l'input nella sidebar)</span>
<span class="ctl">import</span> { Product } <span class="ctl">from</span> <span class="str">'<span class="dynamic-scope">@olon-platform</span>/shared-data'</span>;

<span class="cls">@Injectable</span>()
<span class="ctl">export</span> <span class="kwd">class</span> <span class="cls">ProductsService</span> {
  <span class="mtd">findAll</span>(): <span class="cls">Product</span>[] {
    <span class="ctl">return</span> [
      { id: <span class="str">'1'</span>, name: <span class="str">'Laptop'</span>, price: <span class="num">1500</span>, description: <span class="str">'Workstation'</span> },
      { id: <span class="str">'2'</span>, name: <span class="str">'Mouse'</span>, price: <span class="num">20</span>, description: <span class="str">'Wireless'</span> }
    ];
  }
}</code></pre>
            </div>

            <p>File: <code class="inline">apps/backend/src/main.ts</code> (Abilitazione CORS)</p>
            <div class="code-container">
                <div class="code-header"><div>main.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="cmt">// Import necessari per l'avvio dell'applicazione NestJS</span>
<span class="ctl">import</span> { NestFactory } <span class="ctl">from</span> <span class="str">'@nestjs/core'</span>;
<span class="ctl">import</span> { AppModule } <span class="ctl">from</span> <span class="str">'./app/app.module'</span>;

<span class="ctl">async</span> <span class="kwd">function</span> <span class="mtd">bootstrap</span>() {
  <span class="kwd">const</span> app = <span class="ctl">await</span> NestFactory.<span class="mtd">create</span>(AppModule);
  app.<span class="mtd">setGlobalPrefix</span>(<span class="str">'api'</span>);
  app.<span class="mtd">enableCors</span>(); 
  <span class="ctl">await</span> app.<span class="mtd">listen</span>(<span class="num">3000</span>);
}
<span class="mtd">bootstrap</span>();</code></pre>
            </div>
        </div>

        <div id="section4">
            <h3>4. Frontend (Angular)</h3>
            
            <h4>1. Configurazione Globale</h4>
            <p>File: <code class="inline">apps/frontend/src/app/app.config.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>app.config.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { ApplicationConfig, provideBrowserGlobalErrorListeners } <span class="ctl">from</span> <span class="str">'@angular/core'</span>;
<span class="ctl">import</span> { provideRouter } <span class="ctl">from</span> <span class="str">'@angular/router'</span>;
<span class="cmt">// Import necessario per le chiamate API</span>
<span class="ctl">import</span> { provideHttpClient, withFetch } <span class="ctl">from</span> <span class="str">'@angular/common/http'</span>;
<span class="ctl">import</span> { appRoutes } <span class="ctl">from</span> <span class="str">'./app.routes'</span>;

<span class="ctl">export</span> <span class="kwd">const</span> appConfig: <span class="cls">ApplicationConfig</span> = {
  providers: [
    <span class="mtd">provideBrowserGlobalErrorListeners</span>(), 
    <span class="mtd">provideRouter</span>(appRoutes),
    <span class="cmt">// Registra HttpClient con Fetch API (Best Practice)</span>
    <span class="mtd">provideHttpClient</span>(<span class="mtd">withFetch</span>())
  ],
};</code></pre>
            </div>

            <h4>2. Generazione Service</h4>
            <span class="cmd-label">üëâ Service: Richiede ancora il flag --project</span>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx g @nx/angular:service core/services/product --project=frontend</code></pre>
            </div>
            
            <p>File: <code class="inline">apps/frontend/src/app/core/services/product.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>product.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { Injectable, inject } <span class="ctl">from</span> <span class="str">'@angular/core'</span>;
<span class="ctl">import</span> { HttpClient } <span class="ctl">from</span> <span class="str">'@angular/common/http'</span>;
<span class="cmt">// Import Typesafe dal workspace</span>
<span class="ctl">import</span> { Product } <span class="ctl">from</span> <span class="str">'<span class="dynamic-scope">@olon-platform</span>/shared-data'</span>;
<span class="ctl">import</span> { Observable } <span class="ctl">from</span> <span class="str">'rxjs'</span>;

<span class="cls">@Injectable</span>({ providedIn: <span class="str">'root'</span> })
<span class="ctl">export</span> <span class="kwd">class</span> <span class="cls">ProductService</span> {
  <span class="kwd">private</span> http = <span class="mtd">inject</span>(HttpClient);
  <span class="kwd">private</span> apiUrl = <span class="str">'http://localhost:3000/api/products'</span>;

  <span class="mtd">getProducts</span>(): Observable&lt;<span class="cls">Product</span>[]&gt; {
    <span class="ctl">return</span> <span class="kwd">this</span>.http.<span class="mtd">get</span>&lt;<span class="cls">Product</span>[]&gt;(<span class="kwd">this</span>.apiUrl);
  }
}</code></pre>
            </div>

            <h4>3. Generazione Componente</h4>
            <span class="cmd-label">üëâ Component: Usa il percorso completo</span>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx g @nx/angular:component apps/frontend/src/app/features/product-list</code></pre>
            </div>

            <p>File: <code class="inline">apps/frontend/src/app/features/product-list/product-list.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>product-list.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { Component, inject } <span class="ctl">from</span> <span class="str">'@angular/core'</span>;
<span class="ctl">import</span> { CommonModule } <span class="ctl">from</span> <span class="str">'@angular/common'</span>;
<span class="cmt">// Import relativo (corretto per struttura Nx v20)</span>
<span class="ctl">import</span> { ProductService } <span class="ctl">from</span> <span class="str">'../core/services/product'</span>;

<span class="cls">@Component</span>({
  selector: <span class="str">'app-product-list'</span>,
  standalone: <span class="kwd">true</span>,
  imports: [CommonModule],
  <span class="cmt">// Nota: i file generati seguono il nome del TS (product-list.ts)</span>
  templateUrl: <span class="str">'./product-list.html'</span>,
  styleUrl: <span class="str">'./product-list.scss'</span>,
})
<span class="ctl">export</span> <span class="kwd">class</span> <span class="cls">ProductListComponent</span> {
  <span class="kwd">private</span> productService = <span class="mtd">inject</span>(ProductService);
  products$ = <span class="kwd">this</span>.productService.<span class="mtd">getProducts</span>();
}</code></pre>
            </div>
        </div>

        <div id="section5">
            <h3>5. Esecuzione</h3>
            <p>Lancia l'intero stack in parallelo con un solo comando.</p>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx run-many --target=serve --projects=frontend,backend</code></pre>
            </div>
        </div>
    </div>
    
    <script>
        // Data Binding Dinamico per il nome Workspace
        function updateScope() {
            const input = document.getElementById('ws-name').value;
            let scopeName = input ? input : 'olon-platform';
            if (!scopeName.startsWith('@')) {
                scopeName = '@' + scopeName;
            }

            const elements = document.querySelectorAll('.dynamic-scope');
            elements.forEach(el => {
                el.textContent = scopeName;
            });
        }

        // Funzione Copia
        function copyToClipboard(button) {
            const container = button.closest('.code-container');
            const codeBlock = container.querySelector('pre code');
            
            const textArea = document.createElement("textarea");
            textArea.value = codeBlock.innerText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("Copy");
            textArea.remove();
            
            const originalText = button.innerText;
            button.innerText = "Copiato!";
            button.style.color = "#38bdf8"; 
            button.style.borderColor = "#38bdf8";
            setTimeout(() => { button.innerText = originalText; button.style.color = "#94a3b8"; button.style.borderColor = "#334155"; }, 2000);
        }

        // Scroll Spy (Evidenzia sezione attiva)
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.main-content > div[id]');
            const navLinks = document.querySelectorAll('.sidebar ul li a');

            window.addEventListener('scroll', () => {
                let current = '';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    // Offset per navbar mobile o padding desktop
                    if (pageYOffset >= (sectionTop - 150)) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(a => {
                    a.classList.remove('active');
                    if (a.getAttribute('href').includes(current)) {
                        a.classList.add('active');
                    }
                });
            });
        });
        
        // Init al caricamento
        updateScope();
    </script>
</body>
</html>
