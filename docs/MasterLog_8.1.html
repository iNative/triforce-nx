<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OLON PLATFORM V8.1 - Master Log</title>
    <style>
        :root { 
            --bg-color: #1e1e1e; 
            --sidebar-color: #252526; 
            --text-color: #d4d4d4; 
            --accent-color: #007acc; 
            --border-color: #3e3e42; 
            --kwd: #569cd6; --str: #ce9178; --ctl: #c586c0; --cls: #4ec9b0; --mtd: #dcdcaa; --var: #9cdcfe; --cmt: #6a9955; 
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; }
        
        /* --- SIDEBAR & NAV --- */
        .sidebar { background-color: var(--sidebar-color); border-color: var(--border-color); z-index: 100; transition: all 0.3s ease; }
        .sidebar-header { padding: 15px 20px; font-weight: bold; color: #fff; border-bottom: 1px solid var(--border-color); white-space: nowrap; letter-spacing: 1px; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        
        /* Etichette Menu */
        .sidebar li a { 
            display: block; padding: 12px 20px; color: var(--text-color); text-decoration: none; 
            font-size: 0.9rem; border-left: 4px solid transparent; transition: background 0.2s, border-color 0.2s; 
            white-space: nowrap; font-weight: 500;
        }
        .sidebar li a:hover { background-color: #2a2d2e; }
        .sidebar li a.active { background-color: rgba(0, 122, 204, 0.15); color: #fff; border-left-color: var(--accent-color); }

        /* Config Box Interattivo */
        .config-box { padding: 15px 20px; background: #2d2d2d; border-top: 1px solid var(--border-color); }
        .config-box label { display: block; font-size: 0.7rem; color: #999; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        .config-box input { width: 100%; box-sizing: border-box; background: #1e1e1e; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 0.85rem; font-weight: bold; color: var(--accent-color); }
        .config-box input:focus { border-color: var(--accent-color); outline: none; }
        
        .dynamic-scope { color: #ff9d00; font-weight: bold; text-decoration: underline dotted; cursor: help; }

        /* --- LAYOUT RESPONSIVE --- */
        /* Desktop */
        @media(min-width: 1024px) {
            body { flex-direction: row; }
            .sidebar { width: 260px; height: 100vh; position: fixed; top: 0; left: 0; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; }
            .sidebar ul { flex-grow: 1; overflow-y: auto; }
            .main-content { padding: 40px; width: 100%; max-width: 900px; margin: 0 auto; margin-left: 260px; }
        }
        
        /* Mobile/Tablet (<1024px) */
        @media(max-width: 1023px) {
            .sidebar { 
                width: 100%; height: auto; position: fixed; bottom: 0; left: 0; 
                border-top: 1px solid var(--border-color); display: flex; flex-direction: row; 
                align-items: center; overflow-x: auto; box-shadow: 0 -4px 10px rgba(0,0,0,0.5); 
                justify-content: space-between; 
            }
            .sidebar-header { border-bottom: none; border-right: 1px solid var(--border-color); padding: 10px 15px; font-size: 0.85rem; }
            .sidebar ul { display: flex; flex-direction: row; }
            .sidebar li a { 
                border-left: none; border-top: 4px solid transparent; 
                padding: 15px 15px; font-size: 0.85rem; 
            }
            .sidebar li a.active { border-left-color: transparent; border-top-color: var(--accent-color); }
            .config-box { border-top: none; border-left: 1px solid var(--border-color); padding: 8px; min-width: 140px; }
            .main-content { padding: 20px 20px 100px 20px; width: 100%; box-sizing: border-box; }
        }
        
        /* Typography & Components */
        h1 { border-bottom: 1px solid var(--border-color); padding-bottom: 15px; color: #fff; font-size: 1.8rem; margin-top: 0; }
        h3 { color: var(--accent-color); margin-top: 50px; border-left: 4px solid var(--accent-color); padding-left: 10px; scroll-margin-top: 20px; }
        h4 { color: #fff; margin-top: 30px; margin-bottom: 10px; font-size: 1.1rem; }
        p { line-height: 1.6; color: #ccc; }
        
        code.inline { background-color: #3c3c3c; padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #d7ba7d; word-break: break-all; font-size: 0.9em; }
        
        .code-container { background-color: #1e1e1e; border: 1px solid var(--border-color); border-radius: 6px; margin: 15px 0; position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .code-header { background-color: #2d2d2d; padding: 8px 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; color: #999; font-size: 0.85rem; }
        .copy-btn { background: transparent; border: 1px solid #444; color: #ccc; border-radius: 4px; padding: 4px 10px; cursor: pointer; transition: all 0.2s; font-size: 0.8rem; }
        .copy-btn:hover { background-color: #3e3e42; color: white; border-color: #666; }
        
        pre { margin: 0; padding: 15px; overflow-x: auto; font-family: 'Consolas', 'Monaco', monospace; color: #d4d4d4; font-size: 14px; line-height: 1.5; }
        
        /* Syntax Highlighting */
        .kwd { color: var(--kwd); } .str { color: var(--str); } .ctl { color: var(--ctl); } .cls { color: var(--cls); } .mtd { color: var(--mtd); } .var { color: var(--var); } .cmt { color: #6a9955; }
        .cmd-label { color: #4ec9b0; font-weight: bold; margin-bottom: 5px; display: block; font-size: 0.85rem; letter-spacing: 0.5px; }
        .note { background: #2d2d2d; border-left: 3px solid #ffd700; padding: 15px; font-size: 0.9rem; margin: 20px 0; color: #eee; border-radius: 0 4px 4px 0; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-header">OLON MASTER LOG</div>
        
        <ul>
            <li><a href="#section1" class="nav-link">‚úîÔ∏è 1. Setup</a></li>
            <li><a href="#section2" class="nav-link">üì¶ 2. Shared Types</a></li>
            <li><a href="#section3" class="nav-link">üõ†Ô∏è 3. Backend (Nest)</a></li>
            <li><a href="#section4" class="nav-link">üíª 4. Frontend (Ng)</a></li>
            <li><a href="#section5" class="nav-link">üöÄ 5. Esecuzione</a></li>
        </ul>

        <div class="config-box">
            <label for="ws-name">Workspace Name</label>
            <input type="text" id="ws-name" value="olon-platform" placeholder="es. monoRepo" oninput="updateScope()">
        </div>
    </nav>

    <div class="main-content">
        <h1>üìÇ OLON PLATFORM V8.1 - Master Log</h1>
        <p>Manuale operativo interattivo. Usa la sidebar per aggiornare il nome del progetto in tutti i codici.</p>

        <div id="section1">
            <h3>1. Setup Check</h3>
            <p>
                Si assume che il workspace sia stato inizializzato con lo script <code class="inline">olon-init.sh</code> (disponibile nel README).
            </p>
            <div class="note">‚ö†Ô∏è <b>Action Required:</b> Se non hai ancora il progetto, scarica lo script dal README ed eseguilo.</div>

            <p>Verifica ambiente e lancio setup:</p>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="cmt"># 1. Verifica Node.js (Richiesto v18+)</span>
node -v

<span class="cmt"># 2. Lancia lo script di init se sei nella cartella vuota</span>
bash olon-init.sh</code></pre>
            </div>
        </div>

        <div id="section2">
            <h3>2. Shared Types</h3>
            <p>Definizione contratti dati. Il path di importazione si aggiorna automaticamente in base al tuo workspace.</p>
            
            <p>File: <code class="inline">libs/shared-data/src/lib/product.interface.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>product.interface.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="cmt">// Contratto dati condiviso (Single Source of Truth)</span>
<span class="ctl">export</span> <span class="kwd">interface</span> <span class="cls">Product</span> {
  id: <span class="kwd">string</span>;
  name: <span class="kwd">string</span>;
  price: <span class="kwd">number</span>;
  description: <span class="kwd">string</span>;
}</code></pre>
            </div>
            <p>File: <code class="inline">libs/shared-data/src/index.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>index.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">export</span> * <span class="ctl">from</span> <span class="str">'./lib/shared-data'</span>;
<span class="ctl">export</span> * <span class="ctl">from</span> <span class="str">'./lib/product.interface'</span>;</code></pre>
            </div>
        </div>

        <div id="section3">
            <h3>3. Backend (NestJS)</h3>
            <div class="note">‚ö†Ô∏è <b>Nx v20 Safe:</b> Usiamo il metodo "Path-as-Name" (percorso esplicito) per evitare errori di schema.</div>

            <span class="cmd-label">üëâ Genera Risorsa 'Products' (CRUD)</span>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx g @nx/nest:resource apps/backend/src/app/products --type=rest --crud=<span class="kwd">false</span></code></pre>
            </div>
            
            <p>File: <code class="inline">apps/backend/src/app/products/products.service.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>products.service.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { Injectable } <span class="ctl">from</span> <span class="str">'@nestjs/common'</span>;
<span class="cmt">// Import DINAMICO (si aggiorna con l'input nella sidebar)</span>
<span class="ctl">import</span> { Product } <span class="ctl">from</span> <span class="str">'<span class="dynamic-scope">@olon-platform</span>/shared-data'</span>;

<span class="cls">@Injectable</span>()
<span class="ctl">export</span> <span class="kwd">class</span> <span class="cls">ProductsService</span> {
  <span class="mtd">findAll</span>(): <span class="cls">Product</span>[] {
    <span class="ctl">return</span> [
      { id: <span class="str">'1'</span>, name: <span class="str">'Laptop'</span>, price: <span class="num">1500</span>, description: <span class="str">'Workstation'</span> },
      { id: <span class="str">'2'</span>, name: <span class="str">'Mouse'</span>, price: <span class="num">20</span>, description: <span class="str">'Wireless'</span> }
    ];
  }
}</code></pre>
            </div>

            <p>File: <code class="inline">apps/backend/src/main.ts</code> (Abilitazione CORS)</p>
            <div class="code-container">
                <div class="code-header"><div>main.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="cmt">// Import necessari per l'avvio dell'applicazione NestJS</span>
<span class="ctl">import</span> { NestFactory } <span class="ctl">from</span> <span class="str">'@nestjs/core'</span>;
<span class="ctl">import</span> { AppModule } <span class="ctl">from</span> <span class="str">'./app/app.module'</span>;

<span class="ctl">async</span> <span class="kwd">function</span> <span class="mtd">bootstrap</span>() {
  <span class="kwd">const</span> app = <span class="ctl">await</span> NestFactory.<span class="mtd">create</span>(AppModule);
  app.<span class="mtd">setGlobalPrefix</span>(<span class="str">'api'</span>);
  app.<span class="mtd">enableCors</span>(); 
  <span class="ctl">await</span> app.<span class="mtd">listen</span>(<span class="num">3000</span>);
}
<span class="mtd">bootstrap</span>();</code></pre>
            </div>
        </div>

        <div id="section4">
            <h3>4. Frontend (Angular)</h3>
            
            <h4>1. Configurazione Globale</h4>
            <p>File: <code class="inline">apps/frontend/src/app/app.config.ts</code></p>
            <div class="note">üìù <b>Integrazione:</b> Aggiungi <code>provideHttpClient</code> mantenendo i provider esistenti (es. idratazione/error handling).</div>
            
            <div class="code-container">
                <div class="code-header"><div>app.config.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { ApplicationConfig, provideBrowserGlobalErrorListeners } <span class="ctl">from</span> <span class="str">'@angular/core'</span>;
<span class="ctl">import</span> { provideRouter } <span class="ctl">from</span> <span class="str">'@angular/router'</span>;
<span class="cmt">// Import necessario per le chiamate API</span>
<span class="ctl">import</span> { provideHttpClient, withFetch } <span class="ctl">from</span> <span class="str">'@angular/common/http'</span>;
<span class="ctl">import</span> { appRoutes } <span class="ctl">from</span> <span class="str">'./app.routes'</span>;

<span class="ctl">export</span> <span class="kwd">const</span> appConfig: <span class="cls">ApplicationConfig</span> = {
  providers: [
    <span class="mtd">provideBrowserGlobalErrorListeners</span>(), 
    <span class="mtd">provideRouter</span>(appRoutes),
    <span class="cmt">// Registra HttpClient con Fetch API (Best Practice)</span>
    <span class="mtd">provideHttpClient</span>(<span class="mtd">withFetch</span>())
  ],
};</code></pre>
            </div>

            <h4>2. Generazione Service</h4>
            <span class="cmd-label">üëâ Service: Richiede ancora il flag --project</span>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx g @nx/angular:service core/services/product --project=frontend</code></pre>
            </div>
            
            <p>File: <code class="inline">apps/frontend/src/app/core/services/product.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>product.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { Injectable, inject } <span class="ctl">from</span> <span class="str">'@angular/core'</span>;
<span class="ctl">import</span> { HttpClient } <span class="ctl">from</span> <span class="str">'@angular/common/http'</span>;
<span class="cmt">// Import Typesafe dal workspace</span>
<span class="ctl">import</span> { Product } <span class="ctl">from</span> <span class="str">'<span class="dynamic-scope">@olon-platform</span>/shared-data'</span>;
<span class="ctl">import</span> { Observable } <span class="ctl">from</span> <span class="str">'rxjs'</span>;

<span class="cls">@Injectable</span>({ providedIn: <span class="str">'root'</span> })
<span class="ctl">export</span> <span class="kwd">class</span> <span class="cls">ProductService</span> {
  <span class="kwd">private</span> http = <span class="mtd">inject</span>(HttpClient);
  <span class="kwd">private</span> apiUrl = <span class="str">'http://localhost:3000/api/products'</span>;

  <span class="mtd">getProducts</span>(): Observable&lt;<span class="cls">Product</span>[]&gt; {
    <span class="ctl">return</span> <span class="kwd">this</span>.http.<span class="mtd">get</span>&lt;<span class="cls">Product</span>[]&gt;(<span class="kwd">this</span>.apiUrl);
  }
}</code></pre>
            </div>

            <h4>3. Generazione Componente</h4>
            <span class="cmd-label">üëâ Component: Usa il percorso completo</span>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx g @nx/angular:component apps/frontend/src/app/features/product-list</code></pre>
            </div>

            <p>File: <code class="inline">apps/frontend/src/app/features/product-list/product-list.ts</code></p>
            <div class="code-container">
                <div class="code-header"><div>product-list.ts</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code><span class="ctl">import</span> { Component, inject } <span class="ctl">from</span> <span class="str">'@angular/core'</span>;
<span class="ctl">import</span> { CommonModule } <span class="ctl">from</span> <span class="str">'@angular/common'</span>;
<span class="cmt">// Import relativo (corretto per struttura Nx v20)</span>
<span class="ctl">import</span> { ProductService } <span class="ctl">from</span> <span class="str">'../core/services/product'</span>;

<span class="cls">@Component</span>({
  selector: <span class="str">'app-product-list'</span>,
  standalone: <span class="kwd">true</span>,
  imports: [CommonModule],
  <span class="cmt">// Nota: i file generati seguono il nome del TS (product-list.ts)</span>
  templateUrl: <span class="str">'./product-list.html'</span>,
  styleUrl: <span class="str">'./product-list.scss'</span>,
})
<span class="ctl">export</span> <span class="kwd">class</span> <span class="cls">ProductListComponent</span> {
  <span class="kwd">private</span> productService = <span class="mtd">inject</span>(ProductService);
  products$ = <span class="kwd">this</span>.productService.<span class="mtd">getProducts</span>();
}</code></pre>
            </div>
        </div>

        <div id="section5">
            <h3>5. Esecuzione</h3>
            <p>Lancia l'intero stack in parallelo con un solo comando.</p>
            <div class="code-container">
                <div class="code-header"><div>Terminal</div><button class="copy-btn" onclick="copyToClipboard(this)">Copia</button></div>
                <pre><code>npx nx run-many --target=serve --projects=frontend,backend</code></pre>
            </div>
        </div>
    </div>
    
    <script>
        // Data Binding Dinamico per il nome Workspace
        function updateScope() {
            const input = document.getElementById('ws-name').value;
            let scopeName = input ? input : 'olon-platform';
            if (!scopeName.startsWith('@')) {
                scopeName = '@' + scopeName;
            }

            const elements = document.querySelectorAll('.dynamic-scope');
            elements.forEach(el => {
                el.textContent = scopeName;
            });
        }

        // Funzione Copia
        function copyToClipboard(button) {
            const container = button.closest('.code-container');
            const codeBlock = container.querySelector('pre code');
            
            const textArea = document.createElement("textarea");
            textArea.value = codeBlock.innerText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("Copy");
            textArea.remove();
            
            const originalText = button.innerText;
            button.innerText = "Copiato!";
            button.style.color = "#4ec9b0";
            button.style.borderColor = "#4ec9b0";
            setTimeout(() => { button.innerText = originalText; button.style.color = "#ccc"; button.style.borderColor = "#444"; }, 2000);
        }

        // Scroll Spy (Evidenzia sezione attiva)
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.main-content > div[id]');
            const navLinks = document.querySelectorAll('.sidebar ul li a');

            window.addEventListener('scroll', () => {
                let current = '';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    // Offset per navbar mobile o padding desktop
                    if (pageYOffset >= (sectionTop - 150)) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(a => {
                    a.classList.remove('active');
                    if (a.getAttribute('href').includes(current)) {
                        a.classList.add('active');
                    }
                });
            });
        });
        
        // Init al caricamento
        updateScope();
    </script>
</body>
</html>